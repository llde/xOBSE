<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>user-defined-functions</title>
  <style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
.display.math{display: block; text-align: center; margin: 0.5rem auto;}
</style>
  <style type="text/css">
body {
padding: 10%;
}

h1 {
font-size: 150%;
font-weight: normal;
}
h2 {
font-size: 130%;
font-weight: normal;
margin-top: 40px;
}
h3 {
font-size: 110%;
font-weight: normal;
margin-top: 30px;
color: #000099;
background-color: #ffffff;
}
h4 {
font-size: 100%;
font-weight: bold;
margin-bottom: 0px;
}
h5 {
font-size: 100%;
font-weight: bold;
margin-bottom: 0px;
color: #000099;
background-color: #ffffff;
}

table {
border: 1px solid black;
margin: 20px 0px 20px 0px;
}
caption {
text-align: left;
margin-bottom: 10px;
}
td, th {
padding: 5px;
}
tr.alt {
color: black;
background-color: #dedede;
}
code.alt {
color: 770000;
background-color: #dedede;
}
table.functionIndex td{
padding: 0px 30px 0px 5px;
}

ul {
list-style-type: none;
}

.boxhl {
border: 1px dotted black;
padding: 8px;
color: #000000;
background-color: #eeeeff;
}

.code {
border: 1px solid black;
padding: 20px;
font-family: monospace;
color: #770000;
background-color: #ffffff;
}

pre {
color: #770000;
background-color: #ffffff;
}

code.s {
margin-left: 40px;
font-weight: normal;
color: #770000;
background-color: #ffffff;
}

code {
color: #000000;
background-color: #ffffff;
}

span.op {
font-style: italic;
color: #666666;
background-color: #ffffff;
}

pre.msgbox {
color: #777700;
background-color: #ffffff;
font-family: serif;
}

.ind {
margin-left: 40px;
}
.c {
text-align: center;
}
.l {
text-align: left;
}

.f {
color: #3333cc;
background-color: white;
}
a:link.f{
text-decoration: none;
color: #3333cc;
background-color: white;
}
a:visited.f {
text-decoration: none;
color: #3333cc;
background-color: white;
}
a:focus.f {
text-decoration: underline;
color: #0000ff;
background-color: white;
}
a:hover.f {
text-decoration: underline;
color: #0000ff;
background-color: white;
}
a:active.f {
text-decoration: none;
color: #ff0000;
background-color: white;
}
a:link.cf{
text-decoration: none;
color: #3333cc;
background-color: white;
}
a:visited.cf {
text-decoration: none;
color: #3333cc;
background-color: white;
}
a:focus.cf {
text-decoration: underline;
color: #0000ff;
background-color: white;
}
a:hover.cf {
text-decoration: underline;
color: #0000ff;
background-color: white;
}
a:active.cf {
text-decoration: none;
color: #ff0000;
background-color: white;
}
a:link img {
border-style: none;
}
a:visited img {
border-style: none;
}
</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>User-defined functions (UDFs) can be defined as needed, and can be
called like in other languages. They are object scripts, and in most
circumstances behave the same. They execute within a frame of the game
rendering like most scripts. They can have at most 10 parameters.</p>
<h1 id="defining-a-udf">Defining a UDF</h1>
<p>The script used as a UDF must be an object script. There is only one
possible block type, the function call.</p>
<pre class="ebnf"><code>function = &quot;function&quot;, &quot;{&quot;, {parameter}, &quot;}&quot;;</code></pre>
<pre class="obse"><code>scn UserDefinedFunction
begin function {}
end</code></pre>
<h1 id="using-udfs">Using UDFs</h1>
<p>UDFs behave like most callable functions. Without a return value they
return null. Variables are scoped to only when the function is called.
More UDFs can be called (up to 30 levels of nesting). The only major
difference is that there is only one block, and thus UDFs always fire in
the same manner regardless of game states. In that case, think of UDFs
as a way to better structure the scripts of your plugin.</p>
<p>UDFs do not have a performance cost for calling, however since
scripts need to process within the rendering of the game’s current
frame, it is better to split up functions if they are getting too
big.</p>
<h2 id="calling-udfs">Calling UDFs</h2>
<p>UDFs are called with the <code>call</code> function:</p>
<pre class="ebnf"><code>functionCall = &#39;call&#39;, udf, [{expression}];
udf = scriptName;</code></pre>
<pre class="obse"><code>scn UDFCall
int x
int y
int z
begin gamemode
let x := call ReturnOne
let y := call AddOne y
let z := call Add x y
end</code></pre>
<p>The <code>call</code> function always takes a reference to a script
that is a user-defined function, plus up to 10 arguments. When the
interpreter gets to this point in execution, it simply injects the
execution of this function into that moment of the first script. The
scope of the calling script is not allowed into the called script.
Variables must be passed and returned if needed.</p>
<h2 id="returning-from-udfs">Returning from UDFs</h2>
<p>UDFs always return to the calling script when all possible execution
is done. No value is returned by default (see: <a href="statements.md#return-statement">Return Statement</a>). A specific
function is used to set the value that is returned, <a href="statements.md#userdefined-function-return-statement"><code>SetFunctionValue</code></a>.</p>
<p>This function does not end execution, the return value is still
needed. Instead think of this function creating a temporary variable for
return in this Lua example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">left_greater_right</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">,</span> <span class="va">y</span><span class="op">)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">temp_var</span> <span class="op">=</span> <span class="kw">nil</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="va">y</span> <span class="cf">then</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">temp_var</span> <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">temp_var</span> <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">temp_var</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Notice how if <code>temp_var</code> wasn’t changed explicitly that
the function would return nil. Also note that <code>temp_var</code> was
set in the else block in order to make sure a false value is passed.
This is how <strong>all</strong> UDFs behave. Return value is updated
and then output at the end of execution.</p>
<h2 id="getcallingscript">GetCallingScript</h2>
<p>Returns the reference of the script that called this UDF, or null if
not called by <code>call</code>.</p>
<p><code>(script:ref) GetCallingScript</code></p>
</body>
</html>
